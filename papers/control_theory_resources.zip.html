<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) & !(IE 8)]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>Resources for &#8220;Control Theory for Principled Heap Sizing&#8221; | David R. White</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="http://www.davidrwhite.co.uk/xmlrpc.php" />
<!--[if lt IE 9]>
<script src="http://www.davidrwhite.co.uk/wp-content/themes/twentytwelve/js/html5.js" type="text/javascript"></script>
<![endif]-->
<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link href='https://fonts.gstatic.com' crossorigin rel='preconnect' />
<link rel="alternate" type="application/rss+xml" title="David R. White &raquo; Feed" href="http://www.davidrwhite.co.uk/feed/" />
<link rel="alternate" type="application/rss+xml" title="David R. White &raquo; Comments Feed" href="http://www.davidrwhite.co.uk/comments/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/www.davidrwhite.co.uk\/wp-includes\/js\/wp-emoji-release.min.js?ver=9ab702457e115d470946999eb4979074"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='sfmsb-style-css'  href='http://www.davidrwhite.co.uk/wp-content/plugins/simple-follow-me-social-buttons-widget/assets/css/style.css?ver=3.3.3' type='text/css' media='all' />
<link rel='stylesheet' id='sfmsb-icons-css'  href='http://www.davidrwhite.co.uk/wp-content/plugins/simple-follow-me-social-buttons-widget/assets/css/icons.css?ver=3.3.3' type='text/css' media='all' />
<link rel='stylesheet' id='parent-style-css'  href='http://www.davidrwhite.co.uk/wp-content/themes/twentytwelve/style.css?ver=9ab702457e115d470946999eb4979074' type='text/css' media='all' />
<link rel='stylesheet' id='twentytwelve-fonts-css'  href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700&#038;subset=latin,latin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='twentytwelve-style-css'  href='http://www.davidrwhite.co.uk/wp-content/themes/twentytwelve-child/style.css?ver=9ab702457e115d470946999eb4979074' type='text/css' media='all' />
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentytwelve-ie-css'  href='http://www.davidrwhite.co.uk/wp-content/themes/twentytwelve/css/ie.css?ver=20121010' type='text/css' media='all' />
<![endif]-->
<script type='text/javascript' src='http://www.davidrwhite.co.uk/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='http://www.davidrwhite.co.uk/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript' src='http://www.davidrwhite.co.uk/wp-content/plugins/simple-follow-me-social-buttons-widget/assets/js/front-widget.js?ver=3.3.3'></script>
<link rel='https://api.w.org/' href='http://www.davidrwhite.co.uk/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.davidrwhite.co.uk/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.davidrwhite.co.uk/wp-includes/wlwmanifest.xml" /> 

<link rel="canonical" href="http://www.davidrwhite.co.uk/online-resources-for-control-theory-for-principled-heap-sizing/" />
<link rel='shortlink' href='http://www.davidrwhite.co.uk/?p=48' />
<link rel="alternate" type="application/json+oembed" href="http://www.davidrwhite.co.uk/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fwww.davidrwhite.co.uk%2Fonline-resources-for-control-theory-for-principled-heap-sizing%2F" />
<link rel="alternate" type="text/xml+oembed" href="http://www.davidrwhite.co.uk/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fwww.davidrwhite.co.uk%2Fonline-resources-for-control-theory-for-principled-heap-sizing%2F&#038;format=xml" />
<script type="text/javascript">
(function(url){
	if(/(?:Chrome\/26\.0\.1410\.63 Safari\/537\.31|WordfenceTestMonBot)/.test(navigator.userAgent)){ return; }
	var addEvent = function(evt, handler) {
		if (window.addEventListener) {
			document.addEventListener(evt, handler, false);
		} else if (window.attachEvent) {
			document.attachEvent('on' + evt, handler);
		}
	};
	var removeEvent = function(evt, handler) {
		if (window.removeEventListener) {
			document.removeEventListener(evt, handler, false);
		} else if (window.detachEvent) {
			document.detachEvent('on' + evt, handler);
		}
	};
	var evts = 'contextmenu dblclick drag dragend dragenter dragleave dragover dragstart drop keydown keypress keyup mousedown mousemove mouseout mouseover mouseup mousewheel scroll'.split(' ');
	var logHuman = function() {
		if (window.wfLogHumanRan) { return; }
		window.wfLogHumanRan = true;
		var wfscr = document.createElement('script');
		wfscr.type = 'text/javascript';
		wfscr.async = true;
		wfscr.src = url + '&r=' + Math.random();
		(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(wfscr);
		for (var i = 0; i < evts.length; i++) {
			removeEvent(evts[i], logHuman);
		}
	};
	for (var i = 0; i < evts.length; i++) {
		addEvent(evts[i], logHuman);
	}
})('//www.davidrwhite.co.uk/?wordfence_lh=1&hid=061B55EB2194503855859A59C5F25951');
</script></head>

<body class="page-template-default page page-id-48 full-width custom-font-enabled single-author">
<div id="page" class="hfeed site">
	<header id="masthead" class="site-header" role="banner">
		<hgroup>
			<h1 class="site-title"><a href="http://www.davidrwhite.co.uk/" title="David R. White" rel="home">David R. White</a></h1>
			<h2 class="site-description"></h2>
		</hgroup>

		<nav id="site-navigation" class="main-navigation" role="navigation">
			<button class="menu-toggle">Menu</button>
			<a class="assistive-text" href="#content" title="Skip to content">Skip to content</a>
			<div class="menu-menu-1-container"><ul id="menu-menu-1" class="nav-menu"><li id="menu-item-53" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home menu-item-53"><a href="http://www.davidrwhite.co.uk/">About</a></li>
<li id="menu-item-56" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-56"><a href="http://www.davidrwhite.co.uk/publications/">Publications</a></li>
<li id="menu-item-57" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-57"><a href="http://www.davidrwhite.co.uk/teaching/">Teaching</a></li>
<li id="menu-item-126" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-126"><a href="http://www.davidrwhite.co.uk/blog-2/">Blog</a></li>
</ul></div>		</nav><!-- #site-navigation -->

				<a href="http://www.davidrwhite.co.uk/"><img src="http://www.davidrwhite.co.uk/wp-content/uploads/2014/09/york.jpg" class="header-image" width="4272" height="1157" alt="David R. White" /></a>
			</header><!-- #masthead -->

	<div id="main" class="wrapper">
	<div id="primary" class="site-content">
		<div id="content" role="main">

							
	<article id="post-48" class="post-48 page type-page status-publish hentry">
		<header class="entry-header">
												<h1 class="entry-title">Resources for &#8220;Control Theory for Principled Heap Sizing&#8221;</h1>
		</header>

		<div class="entry-content">
			<p><strong>Authors: David R. White, Jeremy Singer, Jonathan M. Aitken, Richard E. Jones</strong></p>
<p>Jonathan M. Aitken is at the University of Sheffield.</p>
<p><a href="http://www.cs.kent.ac.uk/people/staff/rej/">Richard E. Jones</a> is at the University of Kent.</p>
<hr />
<p>This <a href="http://davidrwhite.co.uk/wp-content/uploads/2014/09/control_theory_for_principled_heap_sizing1.pdf">paper</a> proposed and demonstrated the use of a PID Controller to manage heap size within the Jikes RVM. We used a subset of the DaCapo 2006 MR2 and DaCapo 2009 Benchmarks as example workloads, excluding those that did not run reliably on the RVM. First, we ran tests to examine the normal behaviour of the Jikes heap resizing mechanism when executing these benchmarks. Then we enabled the PID controller and followed the Ziegler-Nichols method of tuning to determine suitable coefficients to be used for each benchmark (for deployment, we would choose a summary statistic of these coefficients).</p>
<p>To evaluate the PID Controller&#8217;s effectiveness, we compared it to the existing Jikes resizing mechanism, and a reimplementation of the HotSpot VM&#8217;s mechanism that we adapted to Jikes.</p>
<p>This webpage contains online resources designed to enable other researchers to recreate and build upon our work.</p>
<p>We actively encourage feedback, debate, suggestions and constructive criticism: please feel free to <a href="mailto:david.r.white@glasgow.ac.uk">contact us</a>.</p>
<h2>Overview</h2>
<p>The patch for the Jikes RVM is not very clean. It evolved through many stages, as with most research, and we have not cleaned it up a great deal. The vital changes to the code could be implemented in a very small patch.</p>
<p>We ran these experiments on a lightly loaded 2011 MacBook Pro, a quadcore machine. To a large extent, the load on the machine should not have a great impact on our results, as we rely only on process CPU time when decided how to change the heap size.</p>
<h2>Download the Archive</h2>
<p>This <a href="http://davidrwhite.co.uk/wp-content/uploads/2014/09/archive.zip">archive</a> contains the directory structure and files required to repeat our work.</p>
<p>If you&#8217;re interested in our work, please <a href="mailto:david.r.white@glasgow.ac.uk">contact us</a> so we can keep track of who is working in this area, and whether it is worthwhile spending some time cleaning up and documenting the source code properly.</p>
<h2>File System Structure</h2>
<p>We checked out Jikes, applied the patch, and created directories as follows:</p>
<ul>
<li>&lt;jikes_root&gt;/experiments</li>
<li>&lt;jikes_root&gt;/results</li>
<li>&lt;jikes_root&gt;/dacapo</li>
<li>&lt;jikes_root&gt;/patch</li>
</ul>
<p>The &#8220;experiments&#8221; directory contains bash scripts to run our experiments, R scripts to analyse our results, and an Excel spreadsheet containing figures measured during the tuning process.</p>
<p>The &#8220;results&#8221; directory holds raw stdout files for the RVM, and cleaned CSV files suitable for processing in the R statistical package (generated by running the relevant &#8220;process&#8221; scripts for each experiment).</p>
<p>The &#8220;dacapo&#8221; directory contains the source code for our phased benchmark used in the final expeirment below.</p>
<p>The &#8220;patch&#8221; directory contains our patch.</p>
<h2>Preparation</h2>
<p>Clone Jikes:</p>
<p><code>hg clone http://hg.code.sourceforge.net/p/jikesrvm/code</code></p>
<p>Switch to the revision we forked from:</p>
<p><code>hg update -r 65aaf607fd8d</code></p>
<p>Uncompress our archive into the resulting directory.</p>
<p>Download DaCapo</p>
<p>Download the DaCapo benchmark jar files for 2006 and 2009 from <a href="http://www.dacapobench.org/">http://www.dacapobench.org</a>. Place these in the &#8220;dacapo&#8221; directory.</p>
<p>Apply our patch:</p>
<p><code>patch -p1 &lt; patch/control_theory_heap_sizing.patch</code></p>
<p>Patch is also available <a href="http://davidrwhite.co.uk/wp-content/uploads/2014/09/control_theory_heap_sizing.txt">here</a>.</p>
<p>Build Jikes (for OS X):</p>
<p><code>ant -Dhost.name=x86_64-osx -Dtarget.name=x86_64-osx -Dconfig.name=FastAdaptiveMarkSweep</code></p>
<h2>Experimentation</h2>
<p>The experiments were run in numerical order. Note that not all the work we performed here is detailed. For example, we considered alternative methods of tuning include the &#8220;impulse&#8221; method, that were discarded for pragmatic reasons.</p>
<h3>Experiment 1 &#8211; Checking Benchmarks Complete Successfully</h3>
<p>Experiments 1a and 1b execute the Da Capo benchmarks on the RVM with a small problem size. By examining their output files, we were able to identify which benchmarks would not execute on the RVM. This can be manually checked with `grep &#8220;PASSED&#8221; 200?.txt` within the results directory.</p>
<h3>Experiment 2 &#8211; Obtain Reasonable Target Values for g (Experiment A in the Paper)</h3>
<p>In experiment two, we ran those benchmarks that completed successfully in Experiment 1, with a 250MB heap size limit using the standard Jikes resizing mechanism. We logged the value of g (GC overhead, passed through a median sliding window filter), and executed continuously until 100 GCs had been completed.</p>
<p>The script &#8220;2_process.sh&#8221; creates an R-friendly results file from the output that was subsequently run through &#8220;2_averages.r&#8221; to measure the median g values over each run. This gave us a sensible target to aim for in our evaluation, i.e. a value of g that we knew was achievable.</p>
<h3>Experiment 3 &#8211; Tune PID (Experiment B in the Paper)</h3>
<p>In experiment 3, we enabled the PID (proportional component only) and ran for 100 GCs with a gain level in the range 7 &#8230; 15. The aim was to find the gain at which clear oscillations could be observed for each benchmark.</p>
<p>The &#8220;3_process.sh&#8221; script cleans up the output files. The &#8220;3_plot.r&#8221; script produces graphs for each benchmark and every gain. These graphs were used to identify gain values at which clear oscillations began, known as the critical gain level in Ziegler-Nichols tuning.</p>
<p>Once we had done this, &#8220;3_median_time_period_measurement.r&#8221; was used to plot only those graphs corresponding to the critical gain levels. Then we were able to use R to estimate the time period of the oscillations using:</p>
<p><code>coords &lt;- locator(type="l")</code></p>
<p>We recorded these measurements in the &#8220;3_tuning_results.xlsx&#8221; file within the experiments directory, which also includes the calculations specified by the Ziegler-Nichols method. This file contains the resulting tuned constants for the PID controller.</p>
<h3>Experiment 4 &#8211; Evaluation (Experiment C in the paper)</h3>
<p>In the evaluation, we ran each benchmark with the tuned controller fully enabled and log the resulting measures of g and the heap size over time. These were used to produce the graphs in the paper. The script &#8220;4_process.sh&#8221; cleans up the data; &#8220;4_plot.r&#8221; then produces the graphs for each benchmark.</p>
<h4>Experiment 5 &#8211; Evaluate Phased Benchmark (Experiment D in the paper)</h4>
<p>For this experiment, we created a phased benchmark that alternates between the xalan and sunflow benchmarks for the DaCapo 2009 benchmarks. The additional source code is within the dacapo/phased directory, and is overlayed on the DaCapo jar. The class that initiates the benchmark is org.dacapo.harness.PhasedHarness.</p>
<p>Scripts &#8220;5a, b and c run the phased benchmark using the PID controller, the default Jikes heap resizing method, and the HotSpot heap resizing method respectively. &#8220;5_process.sh&#8221; cleans up the output, and the &#8220;5_retrieve_phases.sh&#8221; script is a quick hack to produce a file describing phase change locations, to assist in plotting the graph.</p>
<p>Finally, the large graph is plotted with &#8220;5_plot.r&#8221;. There are a few aspects of this script that must be adjusted for specific output (to ensure graph items appear in the right place, there is no overlap of labels and data plot, etc.).</p>
					</div><!-- .entry-content -->
		<footer class="entry-meta">
					</footer><!-- .entry-meta -->
	</article><!-- #post -->
				
<div id="comments" class="comments-area">

	
	
	
</div><!-- #comments .comments-area -->			
		</div><!-- #content -->
	</div><!-- #primary -->


		</div><!-- #main .wrapper -->
	<footer id="colophon" role="contentinfo">
		<div class="site-info">
						<a href="https://wordpress.org/" title="Semantic Personal Publishing Platform">Proudly powered by WordPress</a>
		</div><!-- .site-info -->
	</footer><!-- #colophon -->
</div><!-- #page -->

<script type='text/javascript' src='http://www.davidrwhite.co.uk/wp-content/themes/twentytwelve/js/navigation.js?ver=20140711'></script>
<script type='text/javascript' src='http://www.davidrwhite.co.uk/wp-includes/js/wp-embed.min.js?ver=9ab702457e115d470946999eb4979074'></script>
</body>
</html>